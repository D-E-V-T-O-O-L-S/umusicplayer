<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Next-Gen Music Player - All Phases</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    canvas {
      width: 100%;
      height: 150px;
      background: #000;
    }
    .playlist, .controls {
      margin: 20px;
    }
    #fileInput {
      margin: 10px;
    }
    #videoPlayer {
      width: 100%;
      height: 320px;
      background: #000;
    }
    .qr-code {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>ðŸŽ¶ All-in-One Music & Video Player</h1>

  <!-- Visualizer (Audio Spectrum) -->
  <canvas id="visualizer"></canvas>

  <!-- Video Player -->
  <video id="videoPlayer" controls></video>

  <!-- Audio Player -->
  <audio id="audioPlayer" controls></audio>

  <!-- File Input and Controls -->
  <div class="controls">
    <input type="file" id="fileInput" accept="audio/*, video/*">
    <button onclick="toggleVideoTrim()">ðŸŽž Trim Video</button>
    <button onclick="generateQRCode()">ðŸ“² Generate QR Code</button>
  </div>

  <!-- Playlist Section -->
  <div class="playlist">
    <h3>Your Playlist</h3>
    <button onclick="exportPlaylist()">Export Playlist</button>
    <button onclick="importPlaylist()">Import Playlist</button>
    <ul id="playlist"></ul>
  </div>

  <!-- QR Code Display -->
  <div class="qr-code" id="qrCode"></div>

  <!-- Audio Context Setup -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode"></script>

  <script>
    const audio = document.getElementById("audioPlayer");
    const video = document.getElementById("videoPlayer");
    const canvas = document.getElementById("visualizer");
    const ctx = canvas.getContext("2d");
    const qrCodeElement = document.getElementById("qrCode");

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = audioCtx.createAnalyser();
    const source = audioCtx.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);
    analyser.fftSize = 256;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    function draw() {
      requestAnimationFrame(draw);
      analyser.getByteFrequencyData(dataArray);
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const barWidth = (canvas.width / bufferLength) * 2.5;
      let barHeight, x = 0;

      for (let i = 0; i < bufferLength; i++) {
        barHeight = dataArray[i];
        ctx.fillStyle = `rgb(${barHeight+100},50,50)`;
        ctx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);
        x += barWidth + 1;
      }
    }

    draw();

    // Playlist Management
    let playlist = JSON.parse(localStorage.getItem('playlist')) || [];

    // Update Playlist UI
    function updatePlaylist() {
      const playlistElement = document.getElementById('playlist');
      playlistElement.innerHTML = '';
      playlist.forEach((track, index) => {
        const li = document.createElement('li');
        li.textContent = `Track ${index + 1}`;
        playlistElement.appendChild(li);
      });
    }

    // Add track to playlist
    function addTrackToPlaylist() {
      if (audio.src) {
        playlist.push(audio.src);
        localStorage.setItem('playlist', JSON.stringify(playlist));
        updatePlaylist();
      }
    }

    // Export Playlist as .json
    function exportPlaylist() {
      const blob = new Blob([JSON.stringify(playlist)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'playlist.json';
      link.click();
    }

    // Import Playlist from .json
    function importPlaylist() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (event) => {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            playlist = JSON.parse(e.target.result);
            localStorage.setItem('playlist', JSON.stringify(playlist));
            updatePlaylist();
          } catch (error) {
            alert('Invalid playlist file!');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // YouTube Search + Stream
    async function searchYouTube(query) {
      const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&key=YOUR_YOUTUBE_API_KEY`);
      const data = await response.json();
      const videoUrl = `https://www.youtube.com/watch?v=${data.items[0].id.videoId}`;
      video.src = `https://www.youtube.com/embed/${data.items[0].id.videoId}`;
      video.play();
    }

    // Trim/Crop Video (Simple Placeholder)
    let trimming = false;
    function toggleVideoTrim() {
      trimming = !trimming;
      if (trimming) {
        alert('Trim Video feature activated! (Not implemented yet)');
      } else {
        alert('Video trimming ended.');
      }
    }

    // MP3 Tag Editor (Basic Function)
    function showMP3Tags() {
      alert('Tag Editor feature (show + edit) will be implemented soon!');
    }

    // QR Code Generation
    function generateQRCode() {
      const playlistData = JSON.stringify(playlist);
      qrCodeElement.innerHTML = ''; // Clear existing QR code
      QRCode.toCanvas(qrCodeElement, playlistData, function (error) {
        if (error) console.error(error);
        console.log('QR code generated!');
      });
    }

    // File loader (Audio/Video)
    document.getElementById("fileInput").addEventListener("change", function () {
      const file = this.files[0];
      if (file.type.includes('audio')) {
        audio.src = URL.createObjectURL(file);
        audio.play();
      } else if (file.type.includes('video')) {
        video.src = URL.createObjectURL(file);
        video.play();
      }
    });

  </script>

</body>
</html>

